<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Rosi</title>
  <link rel="stylesheet" href="beta.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>

  <div id="settings" title="Settings">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V15a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51-1z"></path></svg>
  </div>

  <div id="settings-modal">
    <div class="settings-header">
      <h3 class="press-start-2p-regular">SETTINGS</h3>
      <div class="rainbowHr"></div>
    </div>
    <div class="settings-body">
      <label class="toggle-label"><input type="checkbox" id="consoleToggle"> Show Console Output</label>
      <label class="toggle-label"><input type="checkbox" id="advancedToggle"> Show Advanced Options</label>
      <label class="toggle-label"><input type="checkbox" id="convertToggle"> Convert video files to...</label>
      <div id="convertFormatContainer" class="settings-inset">
        <label for="convertFormat">Format:</label>
        <select id="convertFormat">
          <option value="mp4">.mp4 (video)</option>
          <option value="mov">.mov (video)</option>
          <option value="mp3">.mp3 (audio only)</option>
          <option value="m4a">.m4a (audio only)</option>
        </select>
      </div>
      <label id="keepOriginalLabel" class="toggle-label settings-inset"><input type="checkbox" id="keepOriginalToggle"> Keep original file</label>
      <label class="toggle-label">
        <input type="checkbox" id="hookBrowserToggle"> Hook into web browser
        <a href="#" class="info-link" title="Learn more about browser cookies" onclick="window.api.openExternal('https://help.rosie.run/about-browser-cookies'); return false;">?</a>
      </label>
      <div id="browserChoiceContainer" class="settings-inset">
        <label for="browserChoice">Browser:</label>
        <select id="browserChoice">
          <option value="Chrome">Chrome</option>
          <option value="Firefox">Firefox</option>
          <option value="Edge">Edge</option>
          <option value="Brave">Brave</option>
        </select>
      </div>
    </div>
    <center><button id="resetSettings" class="small-btn danger" style="margin-top: 5px; margin-bottom: 10px;">Reset Settings</button></center>
      <p id="version-info">
        <a href="#" onclick="showKeyboardShortcuts(); return false;" style="text-align: center; margin-top: -7px;"><button class="small-btn">Shortcuts</button></a>
        <a href="#" title="View release notes" style="text-align: right; margin-right: 10px;" onclick="window.api.openExternal('https://github.com/BurntToasters/ROSI-msstore/releases/tag/v1.1.7')">V1.1.7-MSSTORE</a>
      </p>
    
  </div>

  <div class="container">
    <header class="app-header">
      <img src="app.png" alt="ROSI Logo" class="app-logo">
      <h1 class="press-start-2p-regular"><b style="color: white;">R</b><b style="color: black;">O</b><b style="color: white;">S</b><b style="color: black;">I</b></h1>
      <h2>A simple yet amazing yt-dlp app.</h2>
    </header>

    <main class="app-main">
      <div class="input-group">
        <input id="url" type="text" placeholder="Enter video URL" />
        <button id="downloadBtn" data-default-text="Download">Download</button>
      </div>

      <div id="formatOptions">
        <button id="fetchFormatsBtn" data-default-text="Check Resolutions">Check Resolutions</button>
        <div class="format-selects">
          <label>Video Format: <select id="videoFormat"></select></label>
          <label>Audio Format: <select id="audioFormat"></select></label>
        </div>
      </div>

      <pre id="output" class="console-output"></pre>
    </main>

    <footer class="app-footer">
      <a href="#" onclick="window.api.openExternal('https://help.rosie.run')"><b style="font-size: 11px;">‚ÑπÔ∏è</b> Help</a>
      <span>|</span>
      <a href="#" onclick="window.api.openExternal('https://rosie.run')"><b style="font-size: 11px;">üåé</b> Website</a>
      <span>|</span>
      <a href="#" onclick="window.api.openExternal('https://rosie.run/support')"><b style="font-size: 11px;">‚ù§Ô∏è</b> Support</a>
      <span>|</span>
      <a href="#" onclick="showLicenses(); return false;"><b style="font-size: 11px;">‚öñÔ∏è</b> Licenses</a>
    </footer>
  </div>

  <div id="app-modal" class="modal-overlay">
    <div class="modal-box">
      <h3 id="modal-title">Modal Title</h3>
      <p id="modal-message">Modal message goes here...</p>
      <div id="modal-buttons"></div>
    </div>
  </div>

  <div id="licenses-overlay" class="modal-overlay">
    <div class="licenses-container">
      <button id="close-licenses" class="close-btn">&times;</button>
      <iframe id="licenses-frame" src="licenses-iframe.html" width="100%" height="100%" frameborder="0"></iframe>
    </div>
  </div>

<script>
  // toggles console output visibility
  function updateConsoleVisibility(show) {
    const outputEl = document.getElementById('output');
    outputEl.style.display = show ? 'block' : 'none';
  }

  // handles loader in button, swaps text for spinner, click cancels
  function setButtonLoading(button, isLoading, onCancel) {
    if (!button) return;
    if (isLoading) {
      button.classList.add('loading');
      button.innerHTML = `<img src="loader.svg" class="loader-icon" alt="Loading...">`;
      button.disabled = false;
      button.onclick = onCancel;
    } else {
      button.classList.remove('loading');
      button.innerHTML = button.dataset.defaultText || button.textContent;
      button.disabled = false;
      button.onclick = button._originalClick;
    }
  }

  function toggleSettingsModal() {
    const modal = document.getElementById('settings-modal');
    if (!modal) return;
    if (modal.style.display !== 'flex') {
      modal.classList.add('showing');
      modal.style.display = 'flex';
      // Force reflow
      void modal.offsetWidth;
      requestAnimationFrame(() => {
        modal.classList.remove('showing');
      });
    } else {
      modal.classList.add('hiding');
      setTimeout(() => {
        modal.style.display = 'none';
        modal.classList.remove('hiding');
      }, 150);
    }
  }
  function toggleAdvancedUI(show) {
    const formatSection = document.getElementById('formatOptions');
    if (formatSection) {
      formatSection.style.display = show ? 'block' : 'none';
    }
  }
  
  function showModal({ title, message, buttons = [] }) {
    const modal = document.getElementById('app-modal');
    const titleEl = document.getElementById('modal-title');
    const msgEl = document.getElementById('modal-message');
    const btnContainer = document.getElementById('modal-buttons');
    if (!modal || !titleEl || !msgEl || !btnContainer) return;
    
    titleEl.textContent = title;
    msgEl.innerHTML = message.replace(/\n/g, '<br>');
    btnContainer.innerHTML = '';
    
    modal.classList.add('showing');
    modal.style.display = 'flex';
    
    void modal.offsetWidth;
    
    requestAnimationFrame(() => {
      modal.classList.remove('showing');
    });
    
    buttons.forEach(({ label, action }) => {
      const btn = document.createElement('button');
      btn.textContent = label;
      btn.onclick = () => {
        hideModal(modal, action);
      };
      btnContainer.appendChild(btn);
    });
  }

  function hideModal(modal, action) {
    modal.classList.add('hiding');
    setTimeout(() => {
      modal.style.display = 'none';
      modal.classList.remove('hiding');
      if (typeof action === 'function') action();
    }, 150);
  }
  
  function updateKeepOriginalToggleState() {
    const keepOriginalToggle = document.getElementById('keepOriginalToggle');
    const keepOriginalLabel = keepOriginalToggle ? keepOriginalToggle.closest('label') : null;
  }


function showKeyboardShortcuts() {
  showModal({
    title: "Keyboard Shortcuts",
    message: `
      <ul style="text-align: left; list-style: none;">
        <li><strong>Ctrl+D:</strong> Restart application</li>
        <li><strong>Ctrl+F:</strong> Focus URL input field</li>
        <li><strong>Ctrl+,:</strong> Open settings</li>
      </ul>
    `,
    buttons: [{ label: "OK" }]
  });
}

  let isFetchingFormats = false;
  let fetchFormatsAbort = null;
  async function fetchFormats() {
    const btn = document.getElementById('fetchFormatsBtn');
    const urlInput = document.getElementById('url');
    const videoUrl = urlInput ? urlInput.value : null;
    if (!btn || !videoUrl || videoUrl.trim() === "") {
      showModal({ title: "Input Error", message: "Please enter a video URL first.", buttons: [{ label: "OK" }] });
      return;
    }
    if (isFetchingFormats) return;
    isFetchingFormats = true;
    fetchFormatsAbort = () => {
      isFetchingFormats = false;
      setButtonLoading(btn, false);
    };
    setButtonLoading(btn, true, () => {
      window.api.cancelDownload();
      fetchFormatsAbort();
    });
    const videoSelect = document.getElementById('videoFormat');
    const audioSelect = document.getElementById('audioFormat');
    if (videoSelect) videoSelect.innerHTML = '<option value="">Loading...</option>';
    if (audioSelect) audioSelect.innerHTML = '<option value="">Loading...</option>';
    try {
      const output = await window.api.getFormats(videoUrl);
      const lines = output.split('\n');
      if (videoSelect) videoSelect.innerHTML = '<option value="">Select Video Format</option>';
      if (audioSelect) audioSelect.innerHTML = '<option value="">Select Audio Format</option>';
      let videoFormatsFound = 0, audioFormatsFound = 0;
      lines.forEach(line => {
        if (/^\s*\d+\s+[a-zA-Z0-9]+/.test(line.trim())) {
          const parts = line.trim().split(/\s+/);
          const formatId = parts[0];
          const option = document.createElement('option');
          option.value = formatId;
          let labelText = line.trim();
          const resolutionMatch = labelText.match(/(\d{3,4}x\d{3,4}|\d{3,4}p)/);
          const fpsMatch = labelText.match(/@\s*(\d+fps)/);
          const sizeMatch = labelText.match(/(\d+(\.\d+)?(MiB|GiB|KiB))/);
          const codecMatch = line.match(/(avc1|vp9|av01|h264|h265|opus|mp4a|aac|vorbis)/i);
          let cleanLabel = `ID: ${formatId}`;
          if (resolutionMatch) cleanLabel += ` ${resolutionMatch[0]}`;
          if (fpsMatch) cleanLabel += ` ${fpsMatch[1]}`;
          if (codecMatch) cleanLabel += ` (${codecMatch[0]})`;
          if (sizeMatch) cleanLabel += ` ~${sizeMatch[0]}`;
          option.text = cleanLabel;
          option.title = line.trim();
          const isVideo = /video/.test(line.toLowerCase()) && !/audio only/i.test(line);
          const isAudio = /audio/.test(line.toLowerCase()) && !/video only/i.test(line);
          const isVideoOnly = /video only/i.test(line);
          const isAudioOnly = /audio only/i.test(line);
          if (isVideoOnly || (isVideo && !isAudio)) {
            if (videoSelect) videoSelect.appendChild(option);
            videoFormatsFound++;
          } else if (isAudioOnly || (isAudio && !isVideo)) {
            if (audioSelect) audioSelect.appendChild(option);
            audioFormatsFound++;
          } else if (isVideo && isAudio) {
            if (videoSelect) videoSelect.appendChild(option);
            videoFormatsFound++;
          }
        }
      });
      if (videoFormatsFound === 0 && videoSelect) videoSelect.innerHTML = '<option value="">No video formats found</option>';
      if (audioFormatsFound === 0 && audioSelect) audioSelect.innerHTML = '<option value="">No audio formats found</option>';
    } catch (e) {
      const errorMessage = typeof e === 'string' ? e : (e.message || 'Unknown error');
      if (videoSelect) videoSelect.innerHTML = '<option value="">Error loading formats</option>';
      if (audioSelect) audioSelect.innerHTML = '<option value="">Error loading formats</option>';
      showModal({
        title: "Format Fetch Failed",
        message: `Could not retrieve formats.\nError: ${errorMessage}`,
        buttons: [{ label: "OK" }]
      });
    } finally {
      isFetchingFormats = false;
      setButtonLoading(btn, false);
    }
  }

  // handles download button logic
  let isDownloading = false;
  let downloadAbort = null;

  // Version compare helper
  function compareVersions(a, b) {
    const pa = a.split('.').map(Number);
    const pb = b.split('.').map(Number);
    for (let i = 0; i < Math.max(pa.length, pb.length); i++) {
      const na = pa[i] || 0, nb = pb[i] || 0;
      if (na > nb) return 1;
      if (na < nb) return -1;
    }
    return 0;
  }

function showLicenses() {
  const licensesOverlay = document.getElementById('licenses-overlay');
  if (licensesOverlay) {
    licensesOverlay.classList.add('showing');
    licensesOverlay.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    void licensesOverlay.offsetWidth;
    requestAnimationFrame(() => {
      licensesOverlay.classList.remove('showing');
    });
  }
}

function hideLicenses() {
  const licensesOverlay = document.getElementById('licenses-overlay');
  if (licensesOverlay) {
    licensesOverlay.classList.add('hiding');
    setTimeout(() => {
      licensesOverlay.style.display = 'none';
      licensesOverlay.classList.remove('hiding');
      document.body.style.overflow = '';
    }, 300);
  }
}

  document.addEventListener('DOMContentLoaded', async () => {
    let settings;
    try {
      settings = await window.api.getSettings();
    } catch (error) {
      settings = {
        showConsoleOutput: false, advancedOptions: false,
        convertToMp4: false, keepOriginalAfterConvert: true, firstLaunch: true
      };
      showModal({ title: "Settings Error", message: "Could not load settings. Using defaults.", buttons: [{ label: "OK" }] });
    }
    const consoleToggle = document.getElementById('consoleToggle');
    const advancedToggle = document.getElementById('advancedToggle');
    const keepOriginalToggle = document.getElementById('keepOriginalToggle');
    const hookBrowserToggle = document.getElementById('hookBrowserToggle');
    const browserChoiceContainer = document.getElementById('browserChoiceContainer');
    const browserChoiceSelect = document.getElementById('browserChoice');
    const convertToggle = document.getElementById('convertToggle');
    const convertFormatContainer = document.getElementById('convertFormatContainer');
    const convertFormatSelect = document.getElementById('convertFormat');
    const keepOriginalLabel = document.getElementById('keepOriginalLabel');
    const outputEl = document.getElementById('output');
    const settingsButton = document.getElementById('settings');
    const settingsModal = document.getElementById('settings-modal');
    const resetSettingsBtn = document.getElementById('resetSettings');
    const fetchFormatsBtn = document.getElementById('fetchFormatsBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const checkUpdateBtn = document.getElementById('checkUpdateBtn');
    if (fetchFormatsBtn) fetchFormatsBtn._originalClick = fetchFormats;
    if (downloadBtn) downloadBtn._originalClick = null;

    // userAgent
    const isWindows = navigator.userAgent.includes('Windows');

    // Filter browser options for Windows
    if (isWindows && browserChoiceSelect) {
      // Only keep Firefox
      Array.from(browserChoiceSelect.options).forEach(opt => {
        if (opt.value !== "Firefox") browserChoiceSelect.removeChild(opt);
      });
      //Firefox
      browserChoiceSelect.value = "Firefox";
    }

    // update UI from settings
    const updateUIFromSettings = () => {
      if (
        !consoleToggle || !advancedToggle || !keepOriginalToggle ||
        !hookBrowserToggle || !browserChoiceContainer || !browserChoiceSelect ||
        !convertToggle || !convertFormatContainer || !convertFormatSelect || !keepOriginalLabel
      ) return;
      consoleToggle.checked = settings.showConsoleOutput ?? false;
      advancedToggle.checked = settings.advancedOptions ?? false;
      keepOriginalToggle.checked = settings.keepOriginalAfterConvert ?? true;
      hookBrowserToggle.checked = settings.hookBrowser ?? false;
      browserChoiceSelect.value = settings.browserChoice ?? "Chrome";
      convertToggle.checked = settings.convertEnabled ?? false;
      convertFormatSelect.value = settings.convertFormat ?? "mp4";
      keepOriginalToggle.checked = settings.keepOriginalAfterConvert ?? true;
      convertFormatContainer.style.display = convertToggle.checked ? 'block' : 'none';
      keepOriginalLabel.style.display = convertToggle.checked ? 'inline-block' : 'none';
      browserChoiceContainer.style.display = settings.hookBrowser ? 'block' : 'none';
      updateConsoleVisibility(settings.showConsoleOutput);
      toggleAdvancedUI(settings.advancedOptions);
    };
    updateUIFromSettings();


    if (!settings.hideSupportModal) {
      showModal({
        title: "Support This Project?",
        message: "Would you like to support the development of ROSI?<br>Your help keeps this project alive!",
        buttons: [
          { label: "‚ù§Ô∏è Yes Support!", action: () => { 
            window.api.openExternal('https://rosie.run/support')
            settings.hideSupportModal = true;
              window.api.saveSettings(settings);
           }},
          { label: "No thanks", action: () => {
              settings.hideSupportModal = true;
              window.api.saveSettings(settings);
            }
          }
        ]
      });
    }


    if (settingsButton) settingsButton.addEventListener('click', toggleSettingsModal);
    document.addEventListener('click', (event) => {
      if (settingsModal && settingsButton && settingsModal.style.display === 'flex' &&
          !settingsModal.contains(event.target) &&
          !settingsButton.contains(event.target)) {
        settingsModal.style.display = 'none';
      }
    });
    document.addEventListener('keydown', (event) => {
      if (settingsModal && event.key === 'Escape' && settingsModal.style.display === 'flex') {
        settingsModal.style.display = 'none';
      }
    });
    if (consoleToggle) consoleToggle.addEventListener('change', (e) => {
      settings.showConsoleOutput = e.target.checked;
      window.api.saveSettings(settings);
      updateConsoleVisibility(settings.showConsoleOutput);
    });
    if (advancedToggle) advancedToggle.addEventListener('change', (e) => {
      settings.advancedOptions = e.target.checked;
      toggleAdvancedUI(e.target.checked);
      window.api.saveSettings(settings);
    });
    if (keepOriginalToggle) keepOriginalToggle.addEventListener('change', (e) => {
      if (!e.target.disabled) {
        settings.keepOriginalAfterConvert = e.target.checked;
        window.api.saveSettings(settings);
      } else {
        e.preventDefault();
      }
    });
    if (hookBrowserToggle) hookBrowserToggle.addEventListener('change', (e) => {
      settings.hookBrowser = e.target.checked;
      if (browserChoiceContainer) browserChoiceContainer.style.display = e.target.checked ? 'block' : 'none';
      window.api.saveSettings(settings);
    });
    if (browserChoiceSelect) browserChoiceSelect.addEventListener('change', (e) => {
      settings.browserChoice = e.target.value;
      window.api.saveSettings(settings);
    });
    if (convertToggle) convertToggle.addEventListener('change', (e) => {
      settings.convertEnabled = e.target.checked;
      convertFormatContainer.style.display = e.target.checked ? 'block' : 'none';
      keepOriginalLabel.style.display = e.target.checked ? 'inline-block' : 'none';
      if (!e.target.checked) {
        settings.keepOriginalAfterConvert = true;
        if (keepOriginalToggle) keepOriginalToggle.checked = true;
      }
      window.api.saveSettings(settings);
    });
    if (convertFormatSelect) convertFormatSelect.addEventListener('change', (e) => {
      settings.convertFormat = e.target.value;
      window.api.saveSettings(settings);
    });
    if (keepOriginalToggle) keepOriginalToggle.addEventListener('change', (e) => {
      settings.keepOriginalAfterConvert = e.target.checked;
      window.api.saveSettings(settings);
    });
    if (resetSettingsBtn) resetSettingsBtn.addEventListener('click', () => {
      showModal({
        title: "Confirm Reset",
        message: "Are you sure you want to reset all settings to default? Rosi will restart.",
        buttons: [
          { label: "Cancel" },
          { label: "‚ü≥ Reset & Restart", action: () => window.api.resetSettings() }
        ]
      });
    });


    if (fetchFormatsBtn) {
      fetchFormatsBtn.onclick = fetchFormats;
    }

    // download button
    if (downloadBtn) {
      downloadBtn._originalClick = async function () {
        if (isDownloading) return;
        const urlInput = document.getElementById('url');
        const url = urlInput ? urlInput.value : null;
        if (!url || url.trim() === "") {
          showModal({ title: "Input Error", message: "Please enter a video URL.", buttons: [{ label: "OK" }] });
          return;
        }
        const videoSelect = document.getElementById('videoFormat');
        const audioSelect = document.getElementById('audioFormat');
        if (settings.advancedOptions && (!videoSelect || !audioSelect || !videoSelect.value || !audioSelect.value)) {
          showModal({ title: "Format Selection Needed", message: "Please check resolutions and select video/audio formats first.", buttons: [{ label: "OK" }] });
          return;
        }
        const savePath = await window.api.selectDownloadLocation();
        if (!savePath) {
          if (outputEl) outputEl.textContent = "‚ö†Ô∏è Download cancelled: No save location selected.";
          return;
        }
        if (outputEl) outputEl.textContent = "";
        isDownloading = true;
        downloadAbort = () => {
          isDownloading = false;
          setButtonLoading(downloadBtn, false);
        };
        setButtonLoading(downloadBtn, true, () => {
          window.api.cancelDownload();
          downloadAbort();
        });
        const videoFormat = settings.advancedOptions ? videoSelect.value : null;
        const audioFormat = settings.advancedOptions ? audioSelect.value : null;
        const convertFormat = settings.convertEnabled ? convertFormatSelect.value : null;
        const keepOriginal = settings.convertEnabled ? keepOriginalToggle.checked : null;
        window.api.downloadVideo({ url, videoFormat, audioFormat, outputPath: savePath, convertFormat, keepOriginal });
      };
      downloadBtn.onclick = downloadBtn._originalClick;
    }


    if (checkUpdateBtn) {
      checkUpdateBtn.onclick = checkForUpdates;
    }


    window.api.onProgress((message) => {
      if (!outputEl) return;
      outputEl.textContent += message + '\n';
      outputEl.scrollTop = outputEl.scrollHeight;
    });
    window.api.onComplete((statusMessage) => {
      if (downloadBtn) {
        isDownloading = false;
        setButtonLoading(downloadBtn, false);
        
        const originalText = downloadBtn.dataset.defaultText || "Download";
        downloadBtn.innerHTML = "‚úÖ Download Complete!";
        downloadBtn.disabled = true;
        setTimeout(() => {
          downloadBtn.innerHTML = originalText;
          downloadBtn.disabled = false;
        }, 4000);
      }
      if (fetchFormatsBtn) setButtonLoading(fetchFormatsBtn, false);
      if (outputEl) {
        outputEl.textContent += statusMessage + '\n';
        outputEl.scrollTop = outputEl.scrollHeight;
      }
    });


    if (settings.firstLaunch) {
      showModal({
        title: "FFMPEG Required for Conversion",
        message: "ROSI uses FFMPEG for converting files to MP4.<br>If you plan to use the MP4 conversion feature, please ensure FFMPEG is installed and accessible in your system's PATH.<br>Click 'More Info' for guidance.",
        buttons: [
          { label: "More Info", action: () => window.api.openExternal('https://help.rosie.run/installing-ffmpeg') },
          { label: "OK" }
        ]
      });
      settings.firstLaunch = false;
      window.api.saveSettings(settings);
    }




const closeBtn = document.getElementById('close-licenses');
if (closeBtn) {
  closeBtn.addEventListener('click', hideLicenses);
}

// esc key
document.addEventListener('keydown', (event) => {
  if (event.key === 'Escape') {
    hideLicenses();
  }
});

// Keyboard shortcuts
document.addEventListener('keydown', (event) => {
  
  if (event.ctrlKey && event.key === 'd') {
    event.preventDefault();
    showModal({
      title: "Restart Application",
      message: "Are you sure you want to restart ROSI?",
      buttons: [
        { label: "Cancel" },
        { label: "Restart", action: () => window.api.restartApp() }
      ]
    });
  }
  
  /*
  if (event.ctrlKey && event.key === 'o') {
    event.preventDefault();
    if (downloadBtn && !isDownloading) downloadBtn._originalClick();
  }
 Test for possible future use
  */
  
  if (event.ctrlKey && event.key === 'f') {
    event.preventDefault();
    const urlInput = document.getElementById('url');
    if (urlInput) {
      urlInput.focus();
      urlInput.select();
    }
  }
  
  
  if (event.ctrlKey && event.key === ',') {
    event.preventDefault();
    toggleSettingsModal();
  }
  
});
  });
</script>

</body>
</html>